# SPDX-License-Identifier: MPL-2.0

name: "(B) ðŸ“… Daily Runtime Build with Pull Upstream"

permissions:
  contents: write

on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:
    inputs:
      debug:
        description: 'Enable Debug Mode'
        required: false
        type: boolean
        default: true
      pgo:
        description: 'Enable Profile-Guided Optimization (PGO)'
        required: false
        type: boolean
        default: true

run-name: "(B) ðŸ“… Daily Runtime Build with Pull Upstream"
# pull-upstream don't affect continuous workflow but in next running
jobs:
  windows-x86_64:
    name: Windows x86_64 build
    uses: ./.github/workflows/wrapper-build-windows.yml
    secrets: inherit
    with:
      debug: ${{ inputs.debug }}
      pgo: ${{ inputs.pgo }}
      pgo_mode: ${{ toJSON(inputs.pgo) == 'true' && 'generate' || '' }}

  linux-x86_64:
    name: Linux x86_64 build
    uses: ./.github/workflows/wrapper-build-linux.yml
    secrets: inherit
    with:
      debug: ${{ inputs.debug }}
      pgo: ${{ inputs.pgo }}
      pgo_mode: ${{ toJSON(inputs.pgo) == 'true' && 'native' || '' }}

  linux-aarch64:
    name: Linux aarch64 build
    uses: ./.github/workflows/common-build.yml
    secrets: inherit
    with:
      platform: linux
      arch: aarch64
      debug: ${{ inputs.debug }}
      pgo: false # PGO is not configured for aarch64 builds
      pgo_mode: ''

  platform-tests:
    name: Platform Tests
    needs: [windows-x86_64, linux-x86_64, linux-aarch64]
    uses: ./.github/workflows/patch-test.yml
    with:
      platform: ubuntu
